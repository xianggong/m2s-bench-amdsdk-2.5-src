SIZE = 1638400

M2S_LIBOPENCL = $(M2S_LIB)/libm2s-opencl.so

BENCHMARK_NAME = Reduction
BENCHMARKS_ROOT = ..

PROGRAM_BINARY_DYNAMIC = $(BENCHMARK_NAME)_dynamic
PROGRAM_BINARY_STATIC = $(BENCHMARK_NAME)_static
KERNEL_SOURCES = $(BENCHMARK_NAME)_Kernels.cl

all: ini $(PROGRAM_BINARY_STATIC) $(PROGRAM_BINARY_DYNAMIC)

clean:
	rm -f benchmark.ini $(BENCHMARK_NAME) $(PROGRAM_BINARY_DYNAMIC) $(PROGRAM_BINARY_STATIC)

$(PROGRAM_BINARY_STATIC): *.cpp $(BENCHMARKS_ROOT)/common/*.cpp $(M2S_LIBOPENCL)
	$(CC) $(CFLAGS) *.cpp $(BENCHMARKS_ROOT)/common/*.cpp -o $(PROGRAM_BINARY_STATIC) $(LDFLAGS_STATIC)

$(PROGRAM_BINARY_DYNAMIC): *.cpp $(BENCHMARKS_ROOT)/common/*.cpp $(M2S_LIBOPENCL)
	$(CC) $(CFLAGS) *.cpp $(BENCHMARKS_ROOT)/common/*.cpp -o $(PROGRAM_BINARY_DYNAMIC) $(LDFLAGS_DYNAMIC)

ini:	
	if [ -a $(BENCHMARK_NAME)_Kernels.bin ] && [ -n "$(SIZE)" ]; then echo '$(CURDIR)/$(PROGRAM_BINARY_STATIC) --load $(BENCHMARK_NAME)_Kernels.bin -q -e -x $(SIZE)' > benchmark.ini; fi;

